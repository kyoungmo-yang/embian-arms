{
  "title": "API Response Monitoring: Service",
  "style": "light",
  "refresh": "1m",
  "dashname": "Service",
  "history_paths":{
    "search_page":"/dashboard/file/search.json",
	"main_page":"/dashboard/file/main.json",
	"service_page":"/dashboard/file/service.json/sub",
	"api_page":"/dashboard/file/api.json/sub"
  },
  "index": {
    "interval": "none",
    "pattern": "[logstash-]YYYY.MM.DD",
    "default": "srm",
    "warm_fields": false
  },
  "services": {
    "filter": {
        "list": {
  		  "0": {
  			  "active": true,
  			  "type": "range",
  			  "field": "timestamp",
  		      "from": 1415611166,
  		      "to": 1415611176
  		  }
      },
      "ids": ["0"],
      "time": {
        "from": "now-1h",
        "to": "now"
      }
    },
    "query": {
		"list": {
		  "0": {
		    "query": "",
		    "alias": "",
		    "color": "#7EB26D",
		    "id": 0,
		    "pin": false,
		    "type": "lucene",
		    "enable": true
		  }
		},
		"ids": [
		  0
		]
	}
  },
  "header": {
	  "title": "{{ARGS.service}}",
	  "panels": [
		  {
			  "span": 12,
			  "type": "sbheader",
			  "source": {
				  "column": "hostname",
				  "series": "dash.service.request_cnt",
				  "rawQuery":true,
				  "cache": true,
				  
				  "query1": "select count(distinct(hostname)) as total from dash.service.request_cnt where service='{{ARGS.service}}'",
				  "query2": "select level, hostname, title, message from status.log where service='{{ARGS.service}}' and time > now() - 20s",
				  "interval": 0
			  }
		  }
	  ]
  },
  "rows":[],
  "lnav": {
	"width": "100px",
    "rows": [
		{
			"title": "",
			"panels": [
		        {
		          "span": 1,
		          "type": "sbhosts",
				  "source": {
					  "column": "hostname",
					  "series": "dash.service.request_cnt",
					  "rawQuery":true,
					  "cache": true,
					  
			          "query1": "select distinct(hostname) as hostname from dash.service.request_cnt where service='{{ARGS.service}}'",
					  "query2": "select level, hostname, title, message from status.log where service='{{ARGS.service}}' and time > now() - 20s",
					  "interval": 0
				  },
				  "rows": [
					  {
						  "height":"200px",
						  "panels": [
							  {
								  "title": "API: 최대 응답시간",
								  "span": 12,
								  "type": "table",
								  "columns": [
									  {"name":"", "field":"", "width":"25px", "type":"index"},
									  {"name":"API", "field":"request", "width":"100%", "type":"link", "to":"#/dashboard/file/api.json", "params":["service", "hostname", "request"]},
									  {"name":"응답시간", "field":"request_time", "width":"60px", "type":"second"}
								  ],
								  "detail": {
									  "limit": 30
								  },
								  "source": {
									  "column": "request_time",
									  "series": "dash.service.request_time",
									  "rawQuery":true,
									  "cache": true,
									  
							          "query": "select max(request_time) as request_time from dash.service.request_time group by hostname, request where hostname='%HOSTNAME%'",
									  "interval": 0,
									  "sortby": "request_time",
									  "limit": 10
								  }
							  }
						  ]
					  },{
						  "height":"200px",
						  "panels": [
							  {
  								  "title": "API: 누적 호출건수",
  								  "span": 12,
  								  "type": "table",
  								  "columns": [
  									  {"name":"", "field":"", "width":"25px", "type":"index"},
  									  {"name":"API", "field":"request", "width":"100%", "type":"link", "to":"#/dashboard/file/api.json", "params":["service", "hostname", "request"]},
  									  {"name":"호출건수", "field":"request_cnt", "width":"60px", "type":"number"}
  								  ],
  								  "detail": {
  									  "limit": 30
  								  },
  								  "source": {
  									  "column": "request_cnt",
  									  "series": "dash.service.request_cnt",
  									  "rawQuery":true,
  									  "cache": true,
		  
  							          "query": "select sum(request_cnt) as request_cnt from dash.service.request_cnt group by hostname, request where hostname='%HOSTNAME%'",
  									  "interval": 0,
  									  "sortby": "request_cnt",
  									  "limit": 10
  								  }
  							  }
						  ]
					  },{
				  		  "height":"200px",
						  "panels": [
							  {
								  "title": "API: 최대 응답사이즈",
								  "span": 12,
								  "type": "table",
								  "columns": [
									  {"name":"", "field":"", "width":"25px", "type":"index"},
									  {"name":"API", "field":"request", "width":"100%", "type":"link", "to":"#/dashboard/file/api.json", "params":["service", "hostname", "request"]},
									  {"name":"사이즈", "field":"bytes_sent", "width":"60px", "type":"number"}
								  ],
								  "detail": {
									  "limit": 30
								  },
								  "source": {
									  "column": "bytes_sent",
									  "series": "dash.service.bytes_sent",
									  "rawQuery":true,
									  "cache": true,
	  
							          "query": "select max(bytes_sent) as bytes_sent from dash.service.bytes_sent group by hostname, request where hostname='%HOSTNAME%'",
									  "interval": 0,
									  "sortby": "bytes_sent",
									  "limit": 10
								  }
							  }
						  ]
					  },{
						  "height":"200px",
						  "panels": [
							  {
								  "title": "API: 오류",
								  "span": 12,
								  "type": "table",
								  "columns": [
									  {"name":"", "field":"", "width":"25px", "type":"index"},
									  {"name":"시간", "field":"time_local", "width":"200px", "type":"text"},
									  {"name":"내용", "field":"content", "width":"100%", "type":"text"}
								  ],
								  "detail": {
									  "limit": 30
								  },
								  "source": {
									  "column": "content",
									  "series": "error.log",
									  "rawQuery":true,
									  "cache": true,
									  
							          "query": "select time_local, service, content from error.log where hostname='%HOSTNAME%' order desc",
									  "interval": 0,
									  "sortby": null,
									  "limit": 10,
									  "colormap": {"red":3600, "yellow":86400},
									  "limitbyquery": true
								  }
							  }
						  ]
					  }
				  ]
		        }
			]
		}
	]
  },
  "content":{
	  "rows": [
	    {
			"height": "200px",
	      "panels": [
	        {
			  "title": "{{ARGS.service}} API: 최대 응답시간",
	          "span": 12,
	          "type": "table",
			  "columns": [
				  {"name":"", "field":"", "width":"25px", "type":"index"},
				  {"name":"호스트", "field":"hostname", "width":"200px", "type":"text"},
				  {"name":"API", "field":"request", "width":"100%", "type":"link", "to":"#/dashboard/file/api.json", "params":["service", "request"]},
				  {"name":"응답시간", "field":"request_time", "width":"60px", "type":"second"}
			  ],
			  "detail": {
				  "limit": 30
			  },
			  "source": {
				  "column": "request_time",
				  "series": "dash.service.request_time",
				  "rawQuery":true,
				  "cache": true,
			  
		          "query": "select max(request_time) as request_time from dash.service.request_time group by hostname, request where service='{{ARGS.service}}'",
				  "interval": 0,
				  "sortby": "request_time",
				  "limit": 10
			  }
	        }
	      ]
	    },
	    {
			"height": "200px",
	      "panels": [
	        {
			  "title": "{{ARGS.service}} API: 누적 호출건수",
	          "span": 12,
	          "type": "table",
			  "columns": [
				  {"name":"", "field":"", "width":"25px", "type":"index"},
				  {"name":"호스트", "field":"hostname", "width":"200px", "type":"text"},
				  {"name":"API", "field":"request", "width":"100%", "type":"link", "to":"#/dashboard/file/api.json", "params":["service", "request"]},
				  {"name":"호출건수", "field":"request_cnt", "width":"60px", "type":"number"}
			  ],
			  "detail": {
				  "limit": 30
			  },
			  "source": {
				  "column": "request_cnt",
				  "series": "dash.service.request_cnt",
				  "rawQuery":true,
				  "cache": true,
			  
		          "query": "select sum(request_cnt) as request_cnt from dash.service.request_cnt group by hostname, request where service='{{ARGS.service}}'",
				  "interval": 0,
				  "sortby": "request_cnt",
				  "limit": 10
			  }
		    }
	 	  ]
	    },
	    {
		  "height": "200px",
	      "panels": [
	        {
			  "title": "{{ARGS.service}} API: 오류",
	          "span": 12,
	          "type": "table",
			  "columns": [
				  {"name":"시간", "field":"time_local", "width":"200px", "type":"text"},
				  {"name":"호스트", "field":"hostname", "width":"200px", "type":"text"},
				  {"name":"내용", "field":"content", "width":"100%", "type":"text"}
			  ],
			  "detail": {
				  "limit": 100
			  },
	          "source": {
				  "column": "content",
				  "series": "error.log",
				  "rawQuery":true,
			  
	              "query": "select time, time_local, hostname, content from error.log where service='{{ARGS.service}}' order desc",
				  "interval": 0,
				  "sortby": null,
				  "limit": 10,
				  "colormap": {"red":3600, "yellow":86400},
				  "limitbyquery": true
	          }
	        }
	      ]
	    }
	  ]
  },
  "nav": [
    {
      "type": "timepicker",
      "collapse": false,
      "notice": false,
      "enable": true,
      "status": "Stable",
      "time_options": [
        "5m",
        "15m",
        "1h",
		"2h",
		"3h",
        "6h",
        "12h",
        "24h"
      ],
      "refresh_intervals": [
        "10s",
        "30s",
        "1m"
      ],
      "now": true
    }
  ]
}
