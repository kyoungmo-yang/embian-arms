{
  "title": "API Response Monitoring: Dashboard",
  "style": "light",
  "refresh": "1m",
  "dashname": "Dashboard",
  "history_paths":{
    "search_page":"/dashboard/file/search.json",
	"main_page":"/dashboard/file/main.json",
	"service_page":"/dashboard/file/service.json/sub",
	"api_page":"/dashboard/file/api.json/sub"
  },
  "index": {
    "interval": "none",
    "pattern": "[logstash-]YYYY.MM.DD",
    "default": "srm",
    "warm_fields": false
  },
  "services": {
	"query": {
		"list": {
		  "0": {
		    "query": "",
		    "alias": "",
		    "color": "#7EB26D",
		    "id": 0,
		    "pin": false,
		    "type": "lucene",
		    "enable": true
		  }
		},
		"ids": [
		  0
		]
	},
    "filter": {
        "list": {
  		  "0": {
  			  "active": true,
  			  "type": "range",
  			  "field": "timestamp",
  		      "from": 1417171400,
  		      "to": 1417172400
  		  }
      },
      "ids": ["0"],
      "time": {
          "from": "now-1h",
          "to": "now"
      }
    }
  },
  "header": {
	  "panels": [
		  {
			  "span": 12,
			  "type": "dashheader",
			  "source": {}
		  }
	  ]
  },
  "rows": [
	{
		"height": "200px",
		"panels": [
			{
			  "title": "서비스: 상태",
		      "span": 12,
		      "type": "sbservices",
			  "href": "#/dashboard/file/service.json",
			  "param": "service",
				  "source": {
					  "column": "service",
					  "series": "dash.service.request_cnt",
					  "rawQuery":true,
					  "cache": true,
					  
			          "query": "select distinct(service) as service from dash.service.request_cnt",
				      "query1": "select count(distinct(hostname)) as total from dash.service.request_cnt where service='%SERVICE%'",
				      "query2": "select level, hostname, title, message from status.log where service='%SERVICE%' and time > now() - 20s",
					  "interval": 0
				  }
			}
		]
	},
	  {
		  "span": 12,
		  "height": "200px",
		  "editable": false,
		  "panels": [
			  {
				  "title": "서비스: 분당 호출 건수",
				  "type":"graph",
				  "datasource": "influxdb",
				  "targets": [
				              {
				                "target": "randomWalk('random walk')",
								"series": "service.log",
				                "function": "count",
				                "column": "request",
								"alias": "$g",
						
								"groupby_field_add": true,
					            "groupby_field": "service",
						
								"fixed_conditions": "",
						
					            "condition_filter": false,
						
					            "condition_key": "",
					            "condition_op": "",
					            "condition_value": "",
						
								"interval": "1m",
				                "query": "",
								"cache": true
				              }
				            ],
					"legend": {
					            "show": true,
					            "values": true,
					            "min": true,
					            "max": true,
					            "current": true,
					            "total": false,
					            "avg": false
					}
			  }
		  ]
	  },
    {
      "height": "200px",
      "panels": [
        {
		  "title": "전체 API: 최대 응답시간",
          "span": 6,
          "type": "table",
		  "columns": [
			  {"name":"", "field":"", "width":"25px", "type":"index"},
			  {"name":"서비스", "field":"service", "width":"100px", "type":"link", "to":"#/dashboard/file/service.json", "params":["service"]},
			  {"name":"API", "field":"request", "width":"100%", "type":"link", "to":"#/dashboard/file/api.json", "params":["service", "request"]},
			  {"name":"응답시간", "field":"request_time", "width":"60px", "type":"second"}
		  ],
		  "detail": {
			  "limit": 30
		  },
		  "source": {
			  "column": "request_time",
			  "series": "dash.service.request_time",
			  "rawQuery":true,
			  "cache": true,
			  
	          "query": "select max(request_time) as request_time from dash.service.request_time group by service, request",
			  "interval": 0,
			  "sortby": "request_time",
			  "limit": 10
		  }
        },
		
        {
		  "title": "전체 API: 누적 호출건수",
          "span": 6,
          "type": "table",
		  "columns": [
			  {"name":"", "field":"", "width":"25px", "type":"index"},
			  {"name":"서비스", "field":"service", "width":"100px", "type":"link", "to":"#/dashboard/file/service.json", "params":["service"]},
			  {"name":"API", "field":"request", "width":"100%", "type":"link", "to":"#/dashboard/file/api.json", "params":["service", "request"]},
			  {"name":"호출건수", "field":"request_cnt", "width":"60px", "type":"number"}
		  ],
		  "detail": {
			  "limit": 30
		  },
		  "source": {
			  "column": "request_cnt",
			  "series": "dash.service.request_cnt",
			  "rawQuery":true,
			  "cache": true,
			  
	          "query": "select sum(request_cnt) as request_cnt from dash.service.request_cnt group by service, request",
			  "interval": 0,
			  "sortby": "request_cnt",
			  "limit": 10
		  }
	    }
      ]
    },

    {
		"height": "200px",
      "panels": [
        {
		  "title": "전체 API: 오류",
          "span": 12,
          "type": "table",
		  "columns": [
			  {"name":"시간", "field":"time_local", "width":"200px", "type":"text"},
			  {"name":"서비스", "field":"service", "width":"100px", "type":"link", "to":"#/dashboard/file/service.json", "params":["service"]},
			  {"name":"내용", "field":"content", "width":"100%", "type":"text"}
		  ],
		  "detail": {
			  "limit": 30
		  },
          "source": {
			  "column": "message",
			  "series": "error.log",
			  "rawQuery":true,
			  
              "query": "select time_local, service, content from error.log order desc",
			  "interval": 0,
			  "sortby": null,
			  "limit": 10,
			  "colormap": {"red":3600, "yellow":86400},
			  "limitbyquery": true
          }
        }
      ]
    }
  ],
  "nav": [
    {
      "type": "timepicker",
      "collapse": false,
      "notice": false,
      "enable": true,
      "status": "Stable",
      "time_options": [
        "5m",
        "15m",
        "1h",
		"2h",
		"3h",
        "6h",
        "12h",
        "24h"
      ],
      "refresh_intervals": [
        "10s",
        "30s",
        "1m"
      ],
      "now": true
    }
  ]
}
